# GMC-4アセンブラマニュアル

## 概要
これは学研の大人の科学マガジンvol.24 の付録 4ビットマイコンでGMC-4用のアセンブラです  
![assembler](https://user-images.githubusercontent.com/14155048/33195791-e3a90324-d11d-11e7-8661-5f32ea87253c.PNG)  
このプログラムはVisual Studio 2017、.NET Framework、Visual C#で開発されています  
授業の一環で作製したので、バグ等はご愛敬

## 使用方法
 ![assembler1](https://user-images.githubusercontent.com/14155048/33195792-e3d002ee-d11d-11e7-9657-25dab9b01ae1.PNG)  
1. "開く"ボタンを押し、アセンブラ言語でコーディングされたプログラムファイル(txtファイル)をインポートします  

2. "アセンブル"ボタンを押し、アセンブラ言語から機械語へと変換します  
アセンブルに成功するとメッセージ欄に"Assembling Successful"と表示されます  
アセンブルに失敗するとメッセージ欄にエラーの原因や箇所が表示されます  
アセンブラ言語のコードはキーボードで編集することができます  

3. "保存"ボタンを押すことで、変換された機械語がtxtファイルに出力されます  
保存されるとメッセージ欄に"Saving Successful"と表示されます  

## 入力ファイル
ファイル形式：txtファイル(.txt)
ファイル名： 自由  
構成：半角英大文字又は半角数字で書かれたアセンブラ言語
  
  
## 出力ファイル
ファイル形式： txtファイル(.txt)  
ファイル名： "assy_"+入力ファイル名  
構成：半角文字(16進数,スペース)合計97ケタ  
　　　（プログラム部80ケタ+区切り半角スペース1ケタ+データ部16ケタ）  
保存先： 入力ファイルと同じディレクトリ  
  
  
## 入力ファイルの規則
1つの命令は1行に書いてください  
複数行にわたって1つの命令をかくことはできません  
空白行は認めません  
ラベル、命令記号、オペランド、コメントは1つ以上の半角スペースで区切ります  

記述法  
1. [ラベル]{空白}{命令記号}{空白}{オペランド}[{空白}[{;}[コメント]]]  
2. [ラベル]{空白}[命令記号]{空白}[{空白}[{;}[コメント]]]  
※[ ]は任意、{ }は必須項目  

### ラベル
ラベルは行の先頭から半角英大文字で始まる8文字の文字列です  
2文字目以下には半角数時を用いることができます  
省略することができます  
省略する場合は半角スペース1つ以上を行の先頭につけてください.

### 命令記号
命令記号は命令のニーモニック又は、制御命令を半角英大文字で書いてください  
サブルーチンは"CAL　＊＊＊"の"CAL"を命令記号に"＊＊＊"をオペランドに書いてください  
サブルーチンは実行フラグが1出ないと実行されません
制御命令"DC"は制御命令"RET"の後ろに書いてください  

#### 制御命令
|命令記号|オペランドの有無|詳細|
|:---|:---:|:---:| 
|START|-|アセンブル作業開始命令| 
|END|-|アセンブル作業終了命令| 
|DC|16進数1ケタ|データ格納命令| 
|RET|-|プログラムの実行終了命令|  

#### 命令のニーモニック
|命令コード<br>(16進数)|命令記号|オペランドの有無|実行フラグ|詳細| 
|:---:|:---|:---:|:---:|:---|
|0|KA|-|0,1|押された数字キー(0~F)をAレジスタに代入する<br>キーが押されてない場合は実行フラグ=1<br>押されたら実行フラグ=0| 
|1|AO|-|1|Aレジスタの値(0~F)を数字LEDに点灯する|
|2|CH|-|1|AレジスタとBレジスタの値を互いに入れ替え<br>さらにYレジスタとZレジスタの値を互いに入れ替える| 
|3|CY|-|1|AレジスタとYレジスタの値を互いに入れ替える| 
|4|AM|-|1|Aレジスタの値をデータメモリ(50+Yレジスタの値)番地に代入する| 
|5|MA|-|1|データメモリ(50+Yレジスタの値)番地の値をAレジスタに代入する| 
|6|M+|-|0,1|Aレジスタにデータメモリ(50+Yレジスタの値)番地の値を足す<br>桁上がりした場合,実行フラグ=1になる<br>それ以外の場合は実行フラグ=0| 
|7|M-|-|0,1|データメモリ(50+Yレジスタの値)番地の値からAレジスタにの値を引いて,結果をAレジスタに代入する<br>値がマイナスになった場合,実行フラグ=1になる<br>それ以外の場合は実行フラグ=0| 
|8|TIA|16進数<br>1ケタ|1|Aレジスタに指定した値(0~F)を代入する| 
|9|AIA|16進数<br>1ケタ|0,1|Aレジスタに指定した値(0~F)を足す<br>桁上がりした場合,実行フラグ=1になる<br>それ以外の場合は実行フラグ=0| 
|A|TIY|16進数<br>1ケタ|1|Yレジスタに指定した値(0~F)を代入する| 
|B|AIY|16進数<br>1ケタ|0,1|Yレジスタに指定した値(0~F)を足す<br>桁上がりした場合,実行フラグ=1になる<br>それ以外の場合は実行フラグ=0| 
|C|CIA|16進数<br>1ケタ|0,1|Aレジスタの値がオペランドと同じ場合,実行フラグ=0になる<br>値が一致しない場合は,実行フラグ=1になる| 
|D|CIY|16進数<br>1ケタ|0,1|Yレジスタの値がオペランドと同じ場合,実行フラグ=0になる<br>値が一致しない場合は,実行フラグ=1になる| 
|E0|CAL|RSTO|1|2進LEDを消灯する|
|E1|CAL|SETR|1|2進LEDの一箇所を点灯させる<br>Yレジスタ=2進LEDのビット番号(0~6)|
|E2|CAL|RSTR|1|2進LEDの一箇所を消灯させる<br>Yレジスタ=2進LEDのビット番号(0~6)|
|E4|CAL|CMPL|1|Aレジスタの値の0と1を反転させる(ビット反転)|
|E5|CAL|CHNG|1|A/B/Y/ZレジスタとA'/B'/Y'/Z'レジスタ(補助レジスタ)の値を互いに入れ替える|
|E6|CAL|SIFT|0,1|Aレジスタの値を1ビット右へシフトする<br>もし元の値が偶数だった場合,実行フラグ=1<br>奇数の場合は実行フラグ=0|
|E7|CAL|ENDS|1|エンド音を鳴らす|
|E8|CAL|ERRS|1|エラー音を鳴らす|
|E9|CAL|SHTS|1|「ピッ」という短い音を鳴らす|
|EA|CAL|LONS|1|「ピー」という長い音を鳴らす|
|EB|CAL|SUND|1|Aレジスタで指定した音階(1~E)の音を鳴らす|
|EC|CAL|TIMR|1|Aレジスタで指定した時間だけ処理を待つ<br>待ち時間は{(Aレジスタの値+1)×0.1}秒|
|ED|CAL|DSPR|1|データメモリの値を2進LEDに点灯する<br>5F番地に上位3ビット,5E番地に下位4ビットの点灯データを格納しておく|
|EE|CAL|DEM-|1|データメモリの値からAレジスタの値を引く<br>計算結果は10進数に変換してから格納する<br>実行後,Yレジスタの値が1つ引かれる|
|EF|CAL|DEM+|1|データメモリの値からAレジスタの値を足す<br>計算結果は10進数に変換してから格納する<br>桁上がりした時には自動的にデータメモリが書き換わる<br>実行後,Yレジスタの値が1つ引かれる|
|F|JUMP|16進数<br>2ケタ|1|実行フラグ=1の場合,指定したアドレスにジャンプする<br>実行フラグ=0の場合,そのまま素通りするが実行フラグは1になる| 

### コメント
命令記号、オペランドの後ろに半角スペースで区切って";"を書くことで、";"の後ろの文字をコメントとすることができます  
コメントはアセンブルに影響を与えません  
  
  
## サンプルコード
↓0x1+0xBの結果を数字LEDに表示  
```
 START
 TIA 1
 AIA B
 AO
 RET
 END
```

↓キーが押されたら短い音を出す
```
 START
LOOP KA
 JUMP LOOP
 CAL SHTS
 RET
 END
```

↓1秒ごとにカウントアップした数値を数字LEDに出力
```
 START
 TIA 0
 TIY 9
INIT AO
 AIA 1
 CY
 CAL TIMR
 CY
 JUMP INIT
 RET
 END
```

## 外部リンク
- [学研の大人の科学マガジンvol.24](http://otonanokagaku.net/magazine/vol24/index.html)